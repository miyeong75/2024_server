<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>회의록 작성</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style_page2.css') }}" />
    <script>
        // 태그를 수집하여 숨겨진 필드에 값을 설정하는 함수
        function collectTagsAndSubmit() {
            // 태그를 수집합니다.
            const tags = Array.from(document.querySelectorAll('#tags .tag span')).map(tag => tag.textContent);
            console.log("Collected tags:", tags);  // 수집된 태그를 콘솔에 출력
            document.getElementById('hiddenTags').value = tags.join(',');
    
            // 수집 후 폼을 제출합니다.
            document.getElementById('myForm').submit();
        }
    
        // DOM이 로드된 후 태그 입력을 처리하는 함수 설정
        document.addEventListener('DOMContentLoaded', function () {
            // 기존 태그 데이터를 렌더링
            const existingTags = {{ tags|tojson }};
            existingTags.forEach(createTag);
    
            // 태그 추가를 위한 이벤트 리스너 설정
            document.getElementById('tagInput').addEventListener('keypress', function (event) {
                if (event.key === 'Enter') {
                    event.preventDefault(); // 폼 제출 방지
                    const tagValue = this.value.trim();
                    if (tagValue) {
                        createTag(tagValue);
                        this.value = ''; // 입력 필드 초기화
                    }
                }
            });
        });
    
        // 태그를 추가하는 함수
        function createTag(label) {
            const div = document.createElement('div');
            div.setAttribute('class', 'tag');
            div.setAttribute('style', 'padding: 4px 8px; margin: 2px; background-color: #e0e0e0; border-radius: 5px; display: inline-block;');
            const span = document.createElement('span');
            span.innerHTML = label;
            const closeIcon = document.createElement('i');
            closeIcon.innerHTML = 'x';
            closeIcon.setAttribute('onclick', 'removeTag(this)');
            div.appendChild(span);
            div.appendChild(closeIcon);
            document.getElementById('tags').appendChild(div);
        }
    
        // 태그를 삭제하는 함수
        function removeTag(element) {
            element.parentNode.remove(); // 부모 div를 삭제하여 태그 삭제
        }
        </script>
      </head>
  <body>
    <header>
        <a href="/mainpage" class="home-link">
            <img src="{{ url_for('static', filename='images/home.png') }}" alt="Home" class="home-icon">
        </a>
        <span class="project-title">{{ project_name }}</span>
    </header>
    <div id="container">
      <div id="sidebar">
        <a href="/projects/{{ project_id }}/todos" class="nav-item">할 일 목록</a>
        <a href="/projects/{{ project_id }}/calendar" class="nav-item">캘린더</a>
        <a href="/projects/{{ project_id }}/minutespage1" class="nav-item active">회의록</a>
        <div class="nav-item">게시판2</div>
      </div>
      <div id="content">
        <div style="width: 1350px; height: 1121px; position: relative; background: #fff;">
            <div style="width: 1224px; height: 134px; position: absolute; left: 0px; top: 10px;">
                <div style = "position: absolute;left: 696px; top: 66px;">
                    <button class="cancel_button" onclick="window.location.href='/projects/{{ project_id }}/minutespage4/{{ minute.MinutesID }}';">취소</button>
                </div>
                <p
                    style="position: absolute; left: 431px; top: 15px; font-size: 20px; font-weight: 600; text-align: left; color: #000;"
                >
                    회의록 수정
                </p>
                <div
                    style="width: 94px; height: 40px; position: absolute; left: 814px; top: 66px; "
                >
                    <button onclick="collectTagsAndSubmit()"
                    class="register_button">수정</button>
                </div>
                </div>
                

            </div>
            
            <p
        style="position: absolute; left: 150px; top: 140px; " calss = "pontmake"
        >
        제목
        </p>
        <p
        style="position: absolute; left: 150px; top: 227px; " calss = "pontmake"
        >
        내용
        </p>
        <div
        style="display: flex; justify-content: flex-start; align-items: flex-start; width: 705px; height: 462px; position: absolute; left: 200px; top: 208px; gap: 8px; padding-left: 16px; padding-right: 16px; padding-top: 12px; padding-bottom: 12px; border-radius: 8px; background: #fff; border-width: 1px; border-color: #e0e0e0; box-shadow: 0px 1px 2px 0 rgba(0,0,0,0.05);"
        >
        <form id="myForm" action="{{ url_for('update_minute', project_id=project_id,minutes_id=minute.MinutesID) }}" method="POST">
        <textarea id="content" name="content"
            style="padding: 10px; border-radius: 5px; border: 1px solid #ccc; height: 500px; flex-grow: 1; width: 673px; font-size: 16px; font-weight: 500; text-align: left; color: #828282;"
            >{{ minute.Content }}
        </textarea>
        </div>
        <div
        style="display: flex; justify-content: flex-start; align-items: flex-start; width: 706px; position: absolute; left: 200px; top: 140px; gap: 8px; padding-left: 16px; padding-right: 16px; padding-top: 12px; padding-bottom: 12px; border-radius: 8px; background: #fff; border-width: 1px; border-color: #e0e0e0; box-shadow: 0px 1px 2px 0 rgba(0,0,0,0.05);"
        >
        <input 
            style="padding: 10px; border-radius: 5px; border: 1px solid #ccc; flex-grow: 0; flex-shrink: 0; width: 100%; font-size: 16px; font-weight: 500; text-align: left; color: #828282;"
            type="text" id="title" name="title" value="{{ minute.Title }}">
        </div>
        <div id="tags" style = "position: absolute; top: 750px; left: 210px; padding-left: 16px; padding-right: 16px;  border-radius: 5px; border: 1px solid #ccc; flex-grow: 0; flex-shrink: 0; width: 706px; font-size: 16px; font-weight: 500; text-align: left; color: #828282;">
            <!-- 기존 태그들이 여기에 미리 채워집니다 -->
        </div>
        <input type="hidden" id="hiddenTags" name="tags">
        <input type="text" id="tagInput" placeholder="Add a new tag" style="position: absolute; top: 800px; left: 210px; margin-top: 10px; width: 706px; padding: 8px; font-size: 16px; color: #828282; border-radius: 5px; border: 1px solid #ccc;">

        
        </form>
        </div>
    
  </body>

</html>